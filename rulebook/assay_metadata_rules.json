{
	"description": "Validation rules for HCA assay metadata. Rules are divided into one group that is applied to all assays, and additional groups based on the assay type",
	"name": "HCA assay metadata rules",
	"further_details_iri": "https://github.com/HumanCellAtlas/metadata-standards",
	"rule_groups": [
		{
			"name": "standard",
			"rules": [
				{
					"mandatory": "mandatory",
					"name": "uuid",
					"description": "Unique ID for assay - generated by HCA",
					"type": "uuid"
				},
				{
					"allow_multiple": true,
					"mandatory": "mandatory",
					"name": "assay type",
					"description": "The type of assay being described - can be multiple, such as RNA and sequencing",
					"type": "text",
					"valid_values": [
						"seq",
						"single_cell",
						"RNA",
						"imaging"
					]
				}
			]
		},
		{
			"condition": {
				"attribute_value_match": {
					"assay type": [
						"seq"
					]
				}
			},
			"name": "sequence",
			"rules": [
				{
					"mandatory": "mandatory",
					"name": "molecule",
					"description": "The molecule being assayed",
					"type": "ontology_text",
					"valid_terms": [
						{
							"ontology_name": "",
							"term_iri": "",
							"allow_descendants": false
						}
					]
				},
				{
					"mandatory": "recommended",
					"name": "machine type",
					"description": "Type of sequencing machine i.e. HiSeq 4000",
					"type": "ontology_text",
					"valid_terms": [
						{
							"ontology_name": "",
							"term_iri": "",
							"allow_descendants": false
						}
					]
				},
				{
					"mandatory": "mandatory",
					"name": "paired ends",
					"description": "Was a paired end sequencing strategy used?",
					"type": "text",
					"valid_values": [
						"yes",
						"no",
						"index1_reads2"
					]
				},
				{
					"mandatory": "optional",
					"name": "prep",
					"description": "DNA sequencing library preparation kit",
					"type": "ontology_text",
					"valid_terms": [
						{
							"ontology_name": "",
							"term_iri": "",
							"allow_descendants": false
						}
					]
				}
			]
		},
		{
			"condition": {
				"attribute_value_match": {
					"assay type": [
						"seq"
					],
					"assay type": [
						"RNA"
					],
					"assay type": [
						"single_cell"
					]
				}
			},
			"name": "umi_barcodes",
			"rules": [
				{
					"mandatory": "mandatory",
					"name": "umi barcode offset",
					"description": "Offset in sequence of unique molecular identifier (UMI) barcode - 0 for beginning of sequence",
					"type": "positive integer"
				},
				{
					"mandatory": "mandatory",
					"name": "umi barcode size",
					"description": "Size  of UMI barcode - 0 for no barcode",
					"type": "positive integer"
				}
			]
		},
		{
			"condition": {
				"attribute_value_match": {
					"assay type": [
						"seq"
					],
					"machine type": [

					],
					"paired ends": [
						"yes"
					]
				}
			},
			"name": "paired end seq",
			"rules": [
				{
					"mandatory": "mandatory",
					"name": "read1",
					"description": "Read _1 in a paired end sequencing assay",
					"type": "file name"
				},
				{
					"mandatory": "mandatory",
					"name": "read2",
					"description": "Read _2 in a paired end sequencing assay",
					"type": "file name"
				},
				{
					"mandatory": "not allowed",
					"name": "index",
					"description": "File containing index reads in an index and read pair"	
				},
				{
					"mandatory": "not allowed",
					"name": "reads",
					"description": "File containing reads in an index and read pair"
				}
			]
		},
		{
			"condition": {
				"attribute_value_match": {
					"assay type": [
						"seq"
					],
					"machine type": [

					],
					"paired ends": [
						"index1_reads2"
					]
				}
			},
			"name": "index1_reads2 seq",
			"rules": [
				{
					"mandatory": "mandatory",
					"name": "index",
					"description": "File containing index reads in an index and read pair",
					"type": "file name"
				},
				{
					"mandatory": "mandatory",
					"name": "reads",
					"description": "File containing reads in an index and read pair",
					"type": "file name"
				},
				{
					"mandatory": "not allowed",
					"name": "read1",
					"description": "Read _1 in a paired end sequencing assay",
				},
				{
					"mandatory": "not allowed",
					"name": "read2",
					"description": "Read _2 in a paired end sequencing assay",
				}
			]
		},
		{
			"condition": {
				"attribute_value_match": {
					"assay type": [
						"seq"
					],
					"machine type": [

					]
				}
			},
			"name": "lanes",
			"rules": [
				{
					"mandatory": "mandatory",
					"name": "lane ID",
					"description": "Lane ID, local to assay",
					"type": "local ID"
				}
			]
		},
		{
			"condition": {
				"attribute_value_match": {
					"assay type": [
						"single_cell"
					],
					"assay type": [
						"not yet defined in metadata but cases where barcodes are obligatory..."
					]
				}
			},
			"name": "single cell with barcodes",
			"rules": [
				{
					"mandatory": "mandatory",
					"name": "cell barcode offset",
					"description": "Offset in sequence of cell identifying barcode - 0 for beginning of sequence",
					"type": "positive integer"
				},
				{
					"mandatory": "mandatory",
					"name": "cell barcode size",
					"description": "Size of cell identifying barcode. 0 for no barcode",
					"type": "positive integer"
				}
			]
		},
		{
			"condition": {
				"attribute_value_match": {
					"assay type": [
						"single_cell"
					]
				}
			},
			"name": "single cell",
			"rules": [
				{
					"mandatory": "mandatory",
					"name": "method",
					"description": "How cells are separated.  FACS, drop-seq, tenX, Fluidigm C1, etc",
					"type": "ontology_text",
					"valid_terms": [
						{
							"ontology_name": "",
							"term_iri": "",
							"allow_descendants": false
						}
					]
				}
			]
		},
		{
			"condition": {
				"attribute_value_match": {
					"assay type": [
						"single_cell"
					],
					"assay type": [
						"not yet defined in metadata but cases where method versions are obligatory..."
					]
				}
			},
			"name": "method version",
			"rules": [
				{
					"mandatory": "mandatory",
					"name": "method_version",
					"type": "text"
				}
			]
		},
		{
			"condition": {
				"attribute_value_match": {
					"assay type": [
						"RNA"
					]
				}
			},
			"name": "RNA",
			"rules": [
			]
		}		
	]
}
